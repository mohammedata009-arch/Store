<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-TAHA | Control Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --admin-bg: #0f172a; --card-bg: #1e293b; --text: #f8fafc; }
        body { font-family: 'Cairo', sans-serif; background: var(--admin-bg); color: var(--text); padding-top: 20px; }
        .card { background: var(--card-bg); border: none; color: white; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .btn-action { font-weight: bold; border-radius: 10px; padding: 10px; }
        .store-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-right: 4px solid #10b981; }
        input, textarea { background: #334155 !important; border: 1px solid #475569 !important; color: white !important; }
        input::placeholder { color: #94a3b8 !important; }
    </style>
</head>
<body>

<div class="container pb-5">
    <div class="text-center mb-5">
        <h1 class="fw-black text-warning">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ | Ù…Ø­Ù…Ø¯ Ø·Ù‡</h1>
        <p class="text-muted">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</p>
    </div>

    <div class="row">
        <div class="col-md-5">
            <div class="card p-4">
                <h5 class="fw-bold mb-3">ğŸ“¢ Ø´Ø±ÙŠØ· Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h5>
                <textarea id="news-text" class="form-control mb-3" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø­Ø§Ù„Ø§Ù‹..."></textarea>
                <div class="d-flex gap-2">
                    <button class="btn btn-warning w-100 fw-bold" onclick="pushNews()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
                    <button class="btn btn-outline-danger" onclick="deleteNews()">Ø­Ø°Ù</button>
                </div>
            </div>

            <div class="card p-4 mt-4">
                <h5 class="fw-bold mb-3">ğŸ†• Ø¥Ø¶Ø§ÙØ© Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯</h5>
                <input type="text" id="new-name" class="form-control mb-2" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…ØªØ¬Ø±/Ø§Ù„Ø¨Ù‚Ø§Ù„Ø©">
                <input type="text" id="new-code" class="form-control mb-3" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ">
                <button class="btn btn-success w-100 fw-bold" onclick="addStore()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± ğŸš€</button>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card p-4">
                <h5 class="fw-bold mb-3">ğŸ‘¥ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† (<span id="count">0</span>)</h5>
                <div id="stores-container">
                    <div class="text-center p-5 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const firebaseConfig = { databaseURL: "https://store-project-b023e-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const rdb = firebase.database();

// --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ---
function pushNews() {
    const msg = document.getElementById('news-text').value.trim();
    if(!msg) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ");
    rdb.ref('admin_announcement').set(msg)
    .then(() => alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ§Ø¬Ø±!"));
}

function deleteNews() {
    rdb.ref('admin_announcement').remove();
    document.getElementById('news-text').value = "";
    alert("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.");
}

// --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø¬Ø± ---
function addStore() {
    const name = document.getElementById('new-name').value.trim();
    const code = document.getElementById('new-code').value.trim();
    if(!name || !code) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    rdb.ref('active_stores/' + code).set({
        name: name,
        created_at: new Date().toLocaleDateString()
    }).then(() => {
        alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('new-name').value = "";
        document.getElementById('new-code').value = "";
    });
}

// Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ù„Ø­Ø¸ÙŠØ§Ù‹
rdb.ref('active_stores').on('value', s => {
    const container = document.getElementById('stores-container');
    const countSpan = document.getElementById('count');
    const data = s.val();
    container.innerHTML = "";
    
    if(!data) {
        container.innerHTML = "<p class='text-center'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
        countSpan.innerText = "0";
        return;
    }

    let count = 0;
    for(let code in data) {
        count++;
        container.innerHTML += `
            <div class="store-item d-flex justify-content-between align-items-center shadow-sm">
                <div>
                    <h6 class="mb-0 fw-bold text-white">${data[code].name}</h6>
                    <small class="text-warning">ÙƒÙˆØ¯: ${code}</small>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-info fw-bold" onclick="viewData('${code}')">Ø¯Ø®ÙˆÙ„</button>
                    <button class="btn btn-sm btn-danger" onclick="removeStore('${code}')">ØªØ¹Ø·ÙŠÙ„</button>
                </div>
            </div>`;
    }
    countSpan.innerText = count;
});

function removeStore(code) {
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙˆØ±Ø§Ù‹.")) {
        rdb.ref('active_stores/' + code).remove();
    }
}

function viewData(code) {
    // Ù…ÙŠØ²Ø© Ù…ØªÙ‚Ø¯Ù…Ø©: ØªÙØªØ­ Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙƒØ£Ù†Ùƒ ØµØ§Ø­Ø¨Ù‡ (Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©)
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø­Ø³Ø§Ø¨Ø§ØªÙ‡ØŸ")) {
        localStorage.setItem('m_taha_session', code);
        window.open('index.html', '_blank');
    }
}
</script>
</body>
</html>
