<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-TAHA ERP | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: 'Cairo', sans-serif; background: #f1f5f9; }
        .admin-card { border-radius: 15px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .store-item { background: white; margin-bottom: 10px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 5px solid #059669; }
        .badge-code { background: #e2e8f0; color: #475569; padding: 5px 10px; border-radius: 5px; font-family: monospace; font-weight: bold; }
    </style>
</head>
<body>

<div class="bg-dark text-white p-3 mb-4 shadow">
    <div class="container d-flex justify-content-between align-items-center">
        <h4 class="m-0 fw-900">M-TAHA | Admin Panel</h4>
        <span class="badge bg-danger">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</span>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-4">
            <div class="card admin-card p-4 mb-4">
                <h5 class="fw-bold mb-3">â• ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯</h5>
                <input type="text" id="new-store-name" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ / Ø§Ù„Ø¨Ù‚Ø§Ù„Ø©">
                <input type="text" id="new-store-code" class="form-control mb-3" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø­Ø±ÙˆÙ)">
                <button class="btn btn-success w-100 fw-bold" onclick="addNewStore()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù†</button>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card admin-card p-4">
                <h5 class="fw-bold mb-3">ğŸª Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                <div id="stores-list">
                    <p class="text-center text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const firebaseConfig = {
    apiKey: "AIzaSyAYJwvrBLc_svZ2IcWBzrBbK_ZpUqX0G8M",
    databaseURL: "https://store-project-b023e-default-rtdb.firebaseio.com",
    projectId: "store-project-b023e",
    appId: "1:561530737705:web:beefb32c081f9bf8b53838"
};
firebase.initializeApp(firebaseConfig);
const rdb = firebase.database();

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø¬Ø±
rdb.ref('active_stores').on('value', snapshot => {
    const list = document.getElementById('stores-list');
    list.innerHTML = "";
    if(!snapshot.exists()) { list.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ§Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹"; return; }

    snapshot.forEach(child => {
        const store = child.val();
        const code = child.key;
        list.innerHTML += `
            <div class="store-item shadow-sm">
                <div>
                    <strong class="fs-5 text-dark">${store.name}</strong><br>
                    <span class="small text-muted">Ø§Ù„ÙƒÙˆØ¯: </span><span class="badge-code">${code}</span>
                </div>
                <div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteStore('${code}')">Ø­Ø°Ù</button>
                    <button class="btn btn-sm btn-warning mx-1" onclick="resetStoreData('${code}')">ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
            </div>
        `;
    });
});

// Ø¥Ø¶Ø§ÙØ© Ù…ØªØ¬Ø±
function addNewStore() {
    const name = document.getElementById('new-store-name').value;
    const code = document.getElementById('new-store-code').value;
    if(!name || !code) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    rdb.ref('active_stores/' + code).set({ name: name })
    .then(() => {
        alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙŠØ§ Ù…Ø­Ù…Ø¯ Ø·Ù‡");
        document.getElementById('new-store-name').value = "";
        document.getElementById('new-store-code').value = "";
    });
}

// Ø­Ø°Ù Ù…ØªØ¬Ø± (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©)
function deleteStore(code) {
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŸ Ù„Ù† ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©.")) {
        rdb.ref('active_stores/' + code).remove();
    }
}

// ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¬Ø± (Ù…Ø®Ø²Ù† ÙˆÙ…Ø¨ÙŠØ¹Ø§Øª)
function resetStoreData(code) {
    if(confirm("ØªØ­Ø°ÙŠØ±! Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒØ§ÙØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
        rdb.ref('stores_data/' + code).remove()
        .then(() => alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"));
    }
}
</script>

</body>
</html>
