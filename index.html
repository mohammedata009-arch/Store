<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙƒØ§Ù† Ø§Ù„Ø°ÙƒÙŠ - Ù…Ø­Ù…Ø¯ Ø·Ù‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --p:#2ecc71; --s:#34495e; --bg:#f4f7f6; --err:#e74c3c; --warn:#f1c40f; }
        body { font-family:'Cairo',sans-serif; background:var(--bg); margin:0; padding-bottom:70px; }
        .container { padding:15px; max-width:500px; margin:auto; }
        .card { background:#fff; border-radius:15px; padding:15px; margin-bottom:15px; box-shadow:0 4px 6px rgba(0,0,0,0.05); }
        input, select { width:100%; padding:12px; border:2px solid #edf2f7; border-radius:10px; margin-top:8px; box-sizing:border-box; font-family:'Cairo'; font-size:16px; }
        .btn { width:100%; padding:15px; border:none; border-radius:10px; color:#fff; font-weight:700; cursor:pointer; font-family:'Cairo'; display:flex; align-items:center; justify-content:center; gap:8px; margin-top:10px; }
        .btn-p { background:var(--p); } .btn-s { background:var(--s); } .btn-err { background:var(--err); } .btn-w { background:#25D366; }
        #ads { display:none; background:var(--warn); padding:8px; position:sticky; top:0; z-index:1000; font-weight:700; text-align:center; }
        .tabs { display:flex; background:#fff; position:fixed; bottom:0; width:100%; border-top:1px solid #ddd; z-index:1000; }
        .tab { flex:1; border:none; background:none; font-family:'Cairo'; color:#95a5a6; font-size:12px; padding:10px 0; }
        .tab.active { color:var(--p); font-weight:700; border-top:3px solid var(--p); }
        .page { display:none; } .page.active { display:block; }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:2000; align-items:center; justify-content:center; }
        .modal-content { background:#fff; width:90%; max-width:350px; padding:20px; border-radius:20px; text-align:center; }
        @media print { .tabs, .btn, #ads, input, select { display:none !important; } #print-area { display:block !important; } }
    </style>
</head>
<body>

<div id="ads"><marquee id="ad-text"></marquee></div>

<div id="lock-screen" style="display:none; position:fixed; inset:0; background:#fff; z-index:9999; padding:40px; text-align:center;">
    <h1 style="margin-top:20%;">ğŸª Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙƒØ§Ù†</h1>
    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡</p>
    <input type="password" id="acc-code" placeholder="Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„">
    <button class="btn btn-p" onclick="verify()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
</div>

<div id="app" class="container">
    <div id="pg-home" class="page active">
        <div class="card" style="background:var(--p); color:#fff; text-align:center;">
            <h3 id="st-name">Ø¯ÙƒØ§Ù†Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h3>
            <h1 id="profit-val">0 Ø¬</h1>
            <small>Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</small>
        </div>
        <div class="card" style="background:var(--s); color:#fff; display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:center;">
            <div><small>Ø±Ø£Ø³ Ù…Ø§Ù„ Ø§Ù„Ù…Ø®Ø²Ù†</small><h3 id="stock-in">0</h3></div>
            <div><small>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</small><h3 id="stock-out">0</h3></div>
        </div>
        <div class="card">
            <h4>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h4>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <button class="btn btn-s" onclick="getRep('stock')">Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†</button>
                <button class="btn btn-s" onclick="getRep('sales')">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</button>
            </div>
            <button class="btn btn-w" onclick="shareWA()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±</button>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
            <button class="btn btn-err" onclick="reset()">ØªØµÙÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</button>
            <button class="btn btn-s" style="background:gray;" onclick="logout()">Ø®Ø±ÙˆØ¬ ğŸšª</button>
        </div>
    </div>

    <div id="pg-sell" class="page">
        <div class="card">
            <h4>ğŸ§¾ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹</h4>
            <select id="p-sel" onchange="updP()"><option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option></select>
            <input type="number" id="p-qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©">
            <input type="number" id="p-prc" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ" readonly style="background:#f8f9fa;">
            <button class="btn btn-p" onclick="sell()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹</button>
        </div>
    </div>

    <div id="pg-stock" class="page">
        <div class="card">
            <h4>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ø¨Ø¶Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h4>
            <input type="text" id="in-n" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="in-b" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
            <input type="number" id="in-s" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±">
            <input type="number" id="in-q" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©">
            <button class="btn btn-p" onclick="addS()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†</button>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <div id="print-area">
            <h3 id="m-tt"></h3>
            <hr>
            <div id="m-bb"></div>
        </div>
        <button class="btn btn-p" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="btn btn-s" style="background:gray" onclick="document.getElementById('modal').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<nav class="tabs">
    <button class="tab active" onclick="nav('pg-home', this)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="tab" onclick="nav('pg-sell', this)">ğŸ§¾ Ø¨ÙŠØ¹</button>
    <button class="tab" onclick="nav('pg-stock', this)">ğŸ“¦ Ù…Ø®Ø²Ù†</button>
</nav>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù…Ø´Ø±ÙˆØ¹Ùƒ Store-project
    const firebaseConfig = {
        apiKey: "AIzaSyAYJwvrBLc_svZ2icW8zrBbKrFyg1METn0",
        authDomain: "store-project-b023e.firebaseapp.com",
        databaseURL: "https://store-project-b023e-default-rtdb.firebaseio.com",
        projectId: "store-project-b023e",
        storageBucket: "store-project-b023e.firebasestorage.app",
        messagingSenderId: "561530737705",
        appId: "1:561530737705:web:beefb32c081f9bf8b53838"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let db = { 
        p: JSON.parse(localStorage.getItem('p')) || [], 
        s: JSON.parse(localStorage.getItem('s')) || [] 
    };
    const sid = localStorage.getItem('sid');

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
    if(!localStorage.getItem('auth')) {
        document.getElementById('lock-screen').style.display='block';
    } else {
        document.getElementById('st-name').innerText = localStorage.getItem('sname');
        initSync();
    }

    function verify() {
        const c = document.getElementById('acc-code').value;
        database.ref('activations/'+c).once('value', s => {
            if(s.exists()){
                localStorage.setItem('auth','1');
                localStorage.setItem('sid',c);
                localStorage.setItem('sname',s.val().name);
                location.reload();
            } else {
                alert("ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­!");
            }
        });
    }

    function logout() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
            localStorage.clear();
            location.reload();
        }
    }

    function initSync() {
        database.ref('stores/'+sid+'/inventory').on('value', s => {
            if(s.exists()){
                db.p = s.val();
                localStorage.setItem('p', JSON.stringify(db.p));
                render();
            }
        });
        database.ref('global_ads').on('value', s => {
            const a = s.val();
            if(a && a.active){
                document.getElementById('ads').style.display = 'block';
                document.getElementById('ad-text').innerText = a.text;
            } else {
                document.getElementById('ads').style.display = 'none';
            }
        });
    }

    function addS() {
        const n=document.getElementById('in-n'), b=document.getElementById('in-b'), s=document.getElementById('in-s'), q=document.getElementById('in-q');
        if(!n.value || !b.value || !s.value || !q.value) return alert("Ø§Ù…Ø³Ø­ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ©!");
        db.p.push({name:n.value, buy:+b.value, sell:+s.value, qty:+q.value});
        sync();
        [n,b,s,q].forEach(i=>i.value="");
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
    }

    function sell() {
        const i=document.getElementById('p-sel').value, q=document.getElementById('p-qty');
        if(i==="" || !q.value) return alert("Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„ÙƒÙ…ÙŠØ©!");
        let item = db.p[i];
        if(item.qty < +q.value) return alert("Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ù„Ø§ ØªÙƒÙÙŠ!");
        
        const profit = (item.sell - item.buy) * +q.value;
        db.s.push({name:item.name, q:+q.value, t:item.sell*+q.value, p:profit, date:new Date().toLocaleDateString()});
        item.qty -= +q.value;
        sync();
        q.value = "";
        alert("ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹");
    }

    function sync() {
        localStorage.setItem('p', JSON.stringify(db.p));
        localStorage.setItem('s', JSON.stringify(db.s));
        database.ref('stores/'+sid+'/inventory').set(db.p);
        database.ref('stores/'+sid+'/daily_stats').set({sales:db.s});
        render();
    }

    function render() {
        const sel = document.getElementById('p-sel');
        sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option>';
        let bV=0, sV=0;
        db.p.forEach((x,i) => {
            if(x.qty > 0){
                sel.innerHTML += `<option value="${i}">${x.name} (Ù…ØªÙˆÙØ±: ${x.qty})</option>`;
                bV += (x.buy * x.qty);
                sV += (x.sell * x.qty);
            }
        });
        document.getElementById('stock-in').innerText = bV + " Ø¬";
        document.getElementById('stock-out').innerText = sV + " Ø¬";
        const today = new Date().toLocaleDateString();
        const p = db.s.filter(x => x.date === today).reduce((a,b) => a + b.p, 0);
        document.getElementById('profit-val').innerText = p + " Ø¬";
    }

    function nav(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
    }

    function updP() {
        const i = document.getElementById('p-sel').value;
        if(i !== "") document.getElementById('p-prc').value = db.p[i].sell;
    }

    function getRep(type) {
        let h = '<table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th></tr>';
        if(type === 'stock') {
            db.p.forEach(x => { if(x.qty > 0) h += `<tr><td>${x.name}</td><td>${x.qty}</td></tr>`; });
        } else {
            db.s.forEach(x => h += `<tr><td>${x.name}</td><td>${x.q}</td></tr>`);
        }
        h += '</table>';
        document.getElementById('m-tt').innerText = (type === 'stock' ? "Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†" : "Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…");
        document.getElementById('m-bb').innerHTML = h;
        document.getElementById('modal').style.display = 'flex';
    }

    function shareWA() {
        const msg = `ØªÙ‚Ø±ÙŠØ± Ø¯ÙƒØ§Ù†: ${localStorage.getItem('sname')}\nØ£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…: ${document.getElementById('profit-val').innerText}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
    }

    function reset() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØµÙÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ")) {
            db.s = [];
            sync();
        }
    }
    render();
</script>
</body>
</html>
