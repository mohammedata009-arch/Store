<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>M-TAHA Pro v100</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --p: #6c5ce7; --s: #00cec9; --bg: #e0e5ec; --txt: #2d3436; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; user-select: none; }
        header { background: var(--p); color: white; padding: 45px 20px 25px; border-radius: 0 0 30px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .container { padding: 15px; max-width: 500px; margin: auto; display: none; }
        .v-card { background: var(--bg); border-radius: 25px; padding: 20px; box-shadow: 9px 9px 16px #bebebe, -9px -9px 16px #ffffff; margin-top: -40px; text-align: center; }
        .radar { width: 140px; height: 140px; border-radius: 50%; background: var(--bg); box-shadow: inset 5px 5px 10px #bebebe, inset -5px -5px 10px #ffffff; margin: 0 auto 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 3px solid var(--s); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .box { padding: 12px; border-radius: 15px; color: white; font-size: 14px; font-weight: bold; }
        .v-input { width: 100%; padding: 14px; margin: 8px 0; border: none; border-radius: 12px; background: var(--bg); box-shadow: inset 3px 3px 6px #bebebe, inset -3px -3px 6px #ffffff; text-align: center; font-family: 'Cairo'; }
        .v-btn { width: 100%; padding: 15px; border: none; border-radius: 15px; background: var(--p); color: white; font-weight: 900; cursor: pointer; margin-top: 10px; }
        nav { position: fixed; bottom: 15px; left: 15px; right: 15px; background: #2d3436; height: 65px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; z-index: 2000; }
        .n-link { color: #636e72; background: none; border: none; font-family: 'Cairo'; font-size: 12px; font-weight: bold; }
        .n-link.active { color: white; transform: translateY(-3px); transition: 0.3s; }
        #lock { position: fixed; inset: 0; background: var(--p); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .page { display: none; animation: fade 0.3s ease; } .page.active { display: block; }
        @keyframes fade { from {opacity:0} to {opacity:1} }
    </style>
</head>
<body>

<div id="lock">
    <div style="font-size: 50px;">ğŸ’</div>
    <h2 style="margin: 10px 0 20px;">M-TAHA v100</h2>
    <input type="password" id="pass" class="v-input" style="max-width:260px; background:white;" placeholder="ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„">
    <button class="v-btn" style="max-width:260px; background:white; color:var(--p)" onclick="verify()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
</div>

<header id="h" style="display:none">
    <div><small>Ø§Ù„Ù…ØªØ¬Ø±:</small><h3 id="sn" style="margin:0">..</h3></div>
    <button onclick="logout()" style="background:rgba(255,255,255,0.2); border:none; color:white; border-radius:8px; padding:5px 12px; font-family:'Cairo'; font-size:12px;">Ø®Ø±ÙˆØ¬</button>
</header>

<div class="container" id="main">
    <div id="p1" class="page active">
        <div class="v-card">
            <div class="radar"><small>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</small><h2 id="net-p" style="margin:0">0</h2></div>
            <div class="grid">
                <div class="box" style="background:#00b894">Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…<br><span id="val-s">0</span></div>
                <div class="box" style="background:#0984e3">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²Ù†<br><span id="val-i">0</span></div>
                <div class="box" style="background:#f1c40f">Ø¯ÙŠÙˆÙ† Ø§Ù„ÙŠÙˆÙ…<br><span id="val-d">0</span></div>
                <div class="box" style="background:#e84393" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</div>
            </div>
        </div>
    </div>

    <div id="p2" class="page">
        <div class="v-card" style="margin-top:10px">
            <h4 style="margin:0 0 10px">ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø³Ø±ÙŠØ¹Ø©</h4>
            <input type="text" id="srch" class="v-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." onkeyup="f()">
            <select id="plist" class="v-input"></select>
            <input type="number" id="qty" class="v-input" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <div class="grid">
                <button class="v-btn" style="background:#00b894; margin:0" onclick="sell(false)">ÙƒØ§Ø´ âœ…</button>
                <button class="v-btn" style="background:#f1c40f; margin:0" onclick="sell(true)">Ø¯ÙŠÙ† ğŸ¤</button>
            </div>
        </div>
    </div>

    <div id="p3" class="page">
        <div class="v-card" style="margin-top:10px">
            <h4>ğŸ“¦ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h4>
            <input type="text" id="in-n" class="v-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="in-b" class="v-input" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
            <input type="number" id="in-s" class="v-input" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
            <input type="number" id="in-q" class="v-input" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¶Ø§ÙØ©">
            <button class="v-btn" onclick="add()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†</button>
        </div>
        <div id="stk-l" style="margin-top: 20px;"></div>
    </div>
</div>

<nav id="n" style="display:none">
    <button class="n-link active" onclick="tab('p1',this)">ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="n-link" onclick="tab('p2',this)">ğŸ§¾ Ø§Ù„Ø¨ÙŠØ¹</button>
    <button class="n-link" onclick="tab('p3',this)">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²Ù†</button>
</nav>

<script>
    const cfg = { databaseURL: "https://store-project-b023e-default-rtdb.firebaseio.com" };
    firebase.initializeApp(cfg); const db = firebase.database();
    let inv=[], sls=[], sid=localStorage.getItem('sid');

    function verify(){
        const k=document.getElementById('pass').value;
        db.ref('activations/'+k).once('value', s=>{
            if(s.exists()){ localStorage.setItem('auth','1'); localStorage.setItem('sid',k); localStorage.setItem('sn',s.val().name); location.reload(); }
            else alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!");
        });
    }

    if(localStorage.getItem('auth')){
        document.getElementById('lock').style.display='none'; document.getElementById('h').style.display='flex'; document.getElementById('main').style.display='block'; document.getElementById('n').style.display='flex';
        document.getElementById('sn').innerText=localStorage.getItem('sn');
        db.ref('stores/'+sid).on('value', s=>{ 
            const d=s.val()||{}; inv=d.inventory||[]; sls=d.sales||[]; u(); render(); 
        });
    }

    function u(){
        const day = new Date().toLocaleDateString('en-GB');
        const sT = sls.filter(x => x.date === day);
        const cash = sT.filter(x=>!x.isD).reduce((a,b)=>a+b.total,0);
        const prof = sT.filter(x=>!x.isD).reduce((a,b)=>a+b.p,0);
        const debt = sT.filter(x=>x.isD).reduce((a,b)=>a+b.total,0);
        const stkv = inv.reduce((a,b)=>a+(b.buy*b.qty),0);
        document.getElementById('net-p').innerText=prof.toFixed(1); 
        document.getElementById('val-s').innerText=cash; 
        document.getElementById('val-d').innerText=debt;
        document.getElementById('val-i').innerText=stkv.toFixed(0); f();
    }

    function sell(isD){
        const i=document.getElementById('plist').value, q=parseInt(document.getElementById('qty').value);
        if(i===""||isNaN(q)||q<=0) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        let itm=inv[i]; if(itm.qty < q) return alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©!");
        itm.qty-=q;
        sls.push({name:itm.name, total:itm.sell*q, p:(itm.sell-itm.buy)*q, isD:isD, date:new Date().toLocaleDateString('en-GB')});
        db.ref('stores/'+sid).update({inventory:inv, sales:sls}).then(()=> { document.getElementById('qty').value=''; alert("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"); });
    }

    function add(){
        const n=document.getElementById('in-n').value, b=parseFloat(document.getElementById('in-b').value), s=parseFloat(document.getElementById('in-s').value), q=parseInt(document.getElementById('in-q').value);
        if(!n || isNaN(b)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        const idx = inv.findIndex(x=>x.name===n);
        if(idx!==-1){ inv[idx].qty+=q; inv[idx].buy=b; inv[idx].sell=s; } else { inv.push({name:n, buy:b, sell:s, qty:q}); }
        db.ref('stores/'+sid+'/inventory').set(inv).then(()=> { document.querySelectorAll('#p3 input').forEach(i=>i.value=''); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); });
    }

    function f(){
        const q=document.getElementById('srch').value.toLowerCase(), s=document.getElementById('plist'); s.innerHTML='';
        inv.forEach((x,i)=> { if(x.name.toLowerCase().includes(q)) s.innerHTML+=`<option value="${i}">${x.name} (${x.qty})</option>`; });
    }

    function render(){
        let h=''; inv.forEach((x,i)=>{ h+=`<div class="v-card" style="margin-top:10px; padding:10px; display:flex; justify-content:space-between; align-items:center; font-size:14px;"><b>${x.name}</b><span>${x.qty} Ù‚</span><button onclick="del(${i})" style="color:red; background:none; border:none; font-size:18px;">ğŸ—‘ï¸</button></div>`; });
        document.getElementById('stk-l').innerHTML=h;
    }

    function tab(id,b){ 
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); 
        document.querySelectorAll('.n-link').forEach(l=>l.classList.remove('active'));
        document.getElementById(id).classList.add('active'); b.classList.add('active');
    }
    function logout(){ if(confirm("Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ")) { localStorage.clear(); location.reload(); } }
    function del(i){ if(confirm("Ø­Ø°Ù Ø§Ù„ØµÙ†Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { inv.splice(i,1); db.ref('stores/'+sid+'/inventory').set(inv); } }
</script>
</body>
</html>
