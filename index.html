<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù†Ø¸Ø§Ù… Ù…Ø­Ù…Ø¯ Ø·Ù‡ - Ù†Ø³Ø®Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700&display=swap" rel="stylesheet">
<style>
    :root { --primary:#27ae60; --secondary:#2c3e50; --bg:#f4f7f6; --danger:#e74c3c; --warning:#f39c12; --info:#3498db; }
    body { font-family:'Cairo',sans-serif; background:var(--bg); margin:0; padding-bottom:90px; }
    .container { padding:15px; max-width:600px; margin:auto; }
    .page { display:none; animation:fadeIn 0.3s; }
    .page.active { display:block; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    .card { background:white; border-radius:15px; padding:15px; box-shadow:0 4px 10px rgba(0,0,0,0.05); margin-bottom:15px; }
    
    label { display: block; font-weight: 700; margin-bottom: 5px; color: var(--secondary); font-size: 14px; margin-top: 10px; }
    input, select { width:100%; padding:14px; border:1px solid #ddd; border-radius:12px; font-size:16px; outline:none; font-family:'Cairo'; box-sizing: border-box; background: #fff; }
    input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(39, 174, 96, 0.2); }
    
    .main-btn { width:100%; padding:15px; border:none; border-radius:12px; background:var(--primary); color:white; font-weight:bold; cursor:pointer; font-size:17px; margin-top:10px; transition: 0.2s; }
    .main-btn:active { transform: scale(0.98); }
    
    .stat-card { text-align:center; padding:15px; border-radius:15px; color:white; flex:1; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .list-item { display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid #eee; }
    
    .bottom-nav { position:fixed; bottom:0; width:100%; background:white; display:flex; justify-content:space-around; padding:12px 0; box-shadow:0 -5px 15px rgba(0,0,0,0.08); z-index:1000; }
    .nav-item { border:none; background:none; color:#7f8c8d; font-size:12px; cursor:pointer; flex:1; font-family:'Cairo'; }
    .nav-item.active { color:var(--primary); font-weight:700; }
    
    .badge { padding: 4px 8px; border-radius: 6px; font-size: 12px; color: white; }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© */
    @media print {
        .bottom-nav, .main-btn, .page, #search, #p-select, label, .card button { display: none !important; }
        #print-area { display: block !important; direction: rtl; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 10px; text-align: center; }
    }
</style>
</head>
<body>

<div class="container" id="app">
    <div id="home" class="page active">
        <h3 style="margin-top:0;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ‘‹</h3>
        <div style="display:flex; gap:12px;">
            <div class="stat-card" style="background:var(--primary);">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ<br><b id="p-total" style="font-size:20px;">0</b></div>
            <div class="stat-card" style="background:var(--info);">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª<br><b id="s-total" style="font-size:20px;">0</b></div>
        </div>
        
        <div class="card" style="margin-top:20px; border-right: 5px solid var(--danger);">
            <h4 style="color:var(--danger); margin:0;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (30 ÙŠÙˆÙ… Ø£Ùˆ Ø£Ù‚Ù„)</h4>
            <div id="exp-list"></div>
        </div>

        <div class="card" style="border-right: 5px solid var(--warning);">
            <h4 style="color:var(--warning); margin:0;">ğŸ“¦ Ø¨Ø¶Ø§Ø¹Ø© Ù‚Ø§Ø±Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ù†ÙˆØ§Ù‚Øµ)</h4>
            <div id="low-list"></div>
        </div>
    </div>

    <div id="sell" class="page">
        <div class="card">
            <h3>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h3>
            
            <label>1. Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</label>
            <input type="text" id="search" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù„Ù„Ø¨Ø­Ø«..." onkeyup="search()">

            <label>2. Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</label>
            <select id="p-select" size="4" onchange="updateSellPrice()"></select>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label>3. Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
                    <input type="number" id="p-qty" placeholder="ÙƒÙ… Ù‚Ø·Ø¹Ø©ØŸ">
                </div>
                <div style="flex:1;">
                    <label>4. Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø­Ø§Ù„ÙŠØ§Ù‹:</label>
                    <input type="number" id="p-price-edit" placeholder="Ø¬">
                </div>
            </div>

            <button class="main-btn" onclick="doSale()">ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ âœ…</button>
        </div>
    </div>

    <div id="stock" class="page">
        <div class="card">
            <h3 id="form-title">ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ø¨Ø¶Ø§Ø¹Ø© Ù„Ù„Ù…Ø®Ø²Ù†</h3>
            
            <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</label>
            <input id="in-name" placeholder="Ù…Ø«Ø§Ù„: Ø²ÙŠØª ØµØ¨Ø§Ø­ 1 Ù„ØªØ±">

            <div style="display: flex; gap: 10px;">
                <div style="flex:1;">
                    <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø¬Ù…Ù„Ø©):</label>
                    <input id="in-buy" type="number" placeholder="0">
                </div>
                <div style="flex:1;">
                    <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù‚Ø·Ø§Ø¹ÙŠ):</label>
                    <input id="in-sell" type="number" placeholder="0">
                </div>
            </div>

            <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©:</label>
            <input id="in-q" type="number" placeholder="ÙƒÙ… Ù‚Ø·Ø¹Ø©ØŸ">

            <label>ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input id="in-exp" type="date">

            <input type="hidden" id="edit-idx" value="-1">
            <button class="main-btn" id="save-btn" onclick="saveStock()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†</button>
            <button class="main-btn" id="cancel-btn" style="background:#95a5a6; display:none;" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        </div>

        <div class="card">
            <h4>Ø¬Ø±Ø¯ Ø¨Ø¶Ø§Ø¹Ø© Ø§Ù„Ù…Ø®Ø²Ù† ÙƒØ§Ù…Ù„Ø©:</h4>
            <div id="full-inventory"></div>
        </div>
    </div>

    <div id="reports" class="page">
        <div class="card">
            <h3>ğŸ“„ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
            <p style="font-size:14px; color:#666;">ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ­ÙØ¸Ù‡ ÙƒÙ…Ù„Ù PDF.</p>
            <button class="main-btn" style="background:var(--secondary);" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± / Ø­ÙØ¸ PDF</button>
        </div>

        <div class="card" style="border: 1px solid var(--danger);">
            <h3 style="color:var(--danger);">âš™ï¸ ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <button class="main-btn" style="background:var(--warning);" onclick="clearSales()">ØªØµÙÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙ‚Ø· (Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…)</button>
            <button class="main-btn" style="background:var(--danger);" onclick="resetEverything()">Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ± âš ï¸</button>
        </div>
    </div>

    <div id="print-area" style="display:none;">
        <h2 style="text-align:center;">ØªÙ‚Ø±ÙŠØ± Ø¨Ù‚Ø§Ù„Ø© Ù…Ø­Ù…Ø¯ Ø·Ù‡</h2>
        <p id="print-date" style="text-align:center;"></p>
        <div id="print-table-container"></div>
    </div>
</div>

<div class="bottom-nav">
    <button class="nav-item active" onclick="tab('home',this)">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="nav-item" onclick="tab('sell',this)">ğŸ§¾<br>Ø§Ù„Ø¨ÙŠØ¹</button>
    <button class="nav-item" onclick="tab('stock',this)">ğŸ“¦<br>Ø§Ù„Ù…Ø®Ø²Ù†</button>
    <button class="nav-item" onclick="tab('reports',this)">âš™ï¸<br>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<script>
let db = {
    p: JSON.parse(localStorage.getItem('p')) || [],
    s: JSON.parse(localStorage.getItem('s')) || []
};

function speak(t) {
    if ('speechSynthesis' in window) {
        let m = new SpeechSynthesisUtterance(t);
        m.lang = 'ar-SA';
        window.speechSynthesis.speak(m);
    }
}

function sync() {
    localStorage.setItem('p', JSON.stringify(db.p));
    localStorage.setItem('s', JSON.stringify(db.s));
    render();
}

function tab(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    if(id === 'sell') {
        document.getElementById('search').value = "";
        search();
    }
}

function search() {
    let q = document.getElementById('search').value.toLowerCase();
    let s = document.getElementById('p-select'); s.innerHTML = "";
    db.p.forEach((item, i) => {
        if(item.name.toLowerCase().includes(q))
            s.innerHTML += `<option value="${i}">${item.name} (Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${item.qty})</option>`;
    });
    if(s.options.length > 0) { 
        s.selectedIndex = 0;
        updateSellPrice();
    }
}

function updateSellPrice() {
    let i = document.getElementById('p-select').value;
    if(i !== "") document.getElementById('p-price-edit').value = db.p[i].sell;
}

function doSale() {
    let i = document.getElementById('p-select').value;
    let q = +document.getElementById('p-qty').value;
    let price = +document.getElementById('p-price-edit').value;

    if(i === "" || q <= 0 || price <= 0) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø³Ø¹Ø±");
    if(db.p[i].qty < q) return alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªÙˆÙØ± Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");

    db.s.unshift({ 
        n: db.p[i].name, 
        q: q, 
        t: q * price, 
        c: q * db.p[i].buy,
        date: new Date().toLocaleDateString('ar-EG')
    });
    
    db.p[i].qty -= q;
    sync();
    speak("ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹");
    
    if(db.p[i].qty <= 5) {
        setTimeout(() => speak("ØªÙ†Ø¨ÙŠÙ‡: ØµÙ†Ù " + db.p[i].name + " Ù‚Ø§Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"), 1000);
    }

    document.getElementById('p-qty').value = "";
    search();
}

function saveStock() {
    let n = document.getElementById('in-name').value, 
        b = +document.getElementById('in-buy').value,
        s = +document.getElementById('in-sell').value, 
        q = +document.getElementById('in-q').value,
        e = document.getElementById('in-exp').value,
        idx = +document.getElementById('edit-idx').value;

    if(!n || b < 0 || s < 0) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");

    if(idx === -1) {
        db.p.push({name:n, buy:b, sell:s, qty:q, exp:e});
        speak("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ù„Ù„Ù…Ø®Ø²Ù†");
    } else {
        db.p[idx] = {name:n, buy:b, sell:s, qty:q, exp:e};
        speak("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        cancelEdit();
    }
    sync();
    ["in-name", "in-buy", "in-sell", "in-q", "in-exp"].forEach(id => document.getElementById(id).value = "");
}

function editP(i) {
    let p = db.p[i];
    document.getElementById('in-name').value = p.name;
    document.getElementById('in-buy').value = p.buy;
    document.getElementById('in-sell').value = p.sell;
    document.getElementById('in-q').value = p.qty;
    document.getElementById('in-exp').value = p.exp || "";
    document.getElementById('edit-idx').value = i;
    document.getElementById('form-title').innerText = "ğŸ”„ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù";
    document.getElementById('cancel-btn').style.display = "block";
    document.getElementById('save-btn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù†";
    window.scrollTo(0,0);
}

function cancelEdit() {
    document.getElementById('edit-idx').value = "-1";
    document.getElementById('form-title').innerText = "ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ø¨Ø¶Ø§Ø¹Ø© Ù„Ù„Ù…Ø®Ø²Ù†";
    document.getElementById('cancel-btn').style.display = "none";
    document.getElementById('save-btn').innerText = "Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†";
    document.getElementById('in-name').value = "";
}

function clearSales() {
    if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„Ù„ÙŠÙˆÙ…ØŸ (Ø§Ù„Ù…Ø®Ø²Ù† Ù„Ù† ÙŠØªØ£Ø«Ø±)")) {
        db.s = []; sync(); speak("ØªÙ… ØªØµÙÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…");
    }
}

function resetEverything() {
    if(confirm("ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù† ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
        localStorage.clear(); location.reload();
    }
}

function render() {
    let ts=0, tc=0;
    let tableHTML = "<table><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>";
    
    db.s.forEach(x => { 
        ts += x.t; tc += x.c; 
        tableHTML += `<tr><td>${x.n}</td><td>${x.q}</td><td>${x.t} Ø¬</td></tr>`;
    });
    
    tableHTML += `</table><h3 dir='rtl'>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${ts.toLocaleString()} Ø¬</h3><h3 dir='rtl'>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­Ù‚Ù‚: ${(ts-tc).toLocaleString()} Ø¬</h3>`;
    document.getElementById('print-table-container').innerHTML = tableHTML;
    document.getElementById('print-date').innerText = new Date().toLocaleString('ar-EG');

    document.getElementById('s-total').innerText = ts.toLocaleString() + " Ø¬";
    document.getElementById('p-total').innerText = (ts-tc).toLocaleString() + " Ø¬";

    let expDiv = document.getElementById('exp-list'); expDiv.innerHTML = "";
    let lowDiv = document.getElementById('low-list'); lowDiv.innerHTML = "";
    let today = new Date();
    
    db.p.forEach((p, i) => {
        if(p.exp) {
            let diff = Math.ceil((new Date(p.exp) - today) / (1000*60*60*24));
            if(diff <= 30) expDiv.innerHTML += `<div class="list-item"><span>${p.name}</span><b class="badge" style="background:var(--danger)">${diff<=0?'Ù…Ù†ØªÙ‡ÙŠ':diff+' ÙŠÙˆÙ…'}</b></div>`;
        }
        if(p.qty <= 5) lowDiv.innerHTML += `<div class="list-item"><span>${p.name}</span><b class="badge" style="background:var(--warning)">${p.qty} Ù‚Ø·Ø¹Ø©</b></div>`;
    });

    let invDiv = document.getElementById('full-inventory'); invDiv.innerHTML = "";
    db.p.forEach((p, i) => {
        invDiv.innerHTML += `<div class="list-item">
            <div style="flex:2;"><b>${p.name}</b><br><small>Ø§Ù„Ø³Ø¹Ø±: ${p.sell} | Ø§Ù„ÙƒÙ…ÙŠØ©: ${p.qty}</small></div>
            <div style="flex:1; text-align:left;">
                <button onclick="editP(${i})" style="background:none; border:none; color:var(--info); cursor:pointer; font-weight:700;">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="if(confirm('Ø­Ø°ÙØŸ')) {db.p.splice(${i},1); sync();}" style="background:none; border:none; color:var(--danger); cursor:pointer; font-weight:700; margin-right:10px;">Ø­Ø°Ù</button>
            </div>
        </div>`;
    });
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
render();
</script>
</body>
</html>
