<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¯ÙƒØ§ÙƒÙŠÙ† ğŸª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --primary:#27ae60; --secondary:#2c3e50; --bg:#f4f7f6; --danger:#e74c3c; }
        body { font-family:'Cairo',sans-serif; background:var(--bg); margin:0; padding-bottom:80px; }
        .card { background:white; border-radius:15px; padding:15px; margin:10px; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
        input, select { width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; margin-top:10px; box-sizing:border-box; }
        .main-btn { width:100%; padding:15px; border:none; border-radius:10px; background:var(--primary); color:white; font-weight:bold; cursor:pointer; margin-top:10px; }
        .bottom-nav { position:fixed; bottom:0; width:100%; background:white; display:flex; justify-content:space-around; padding:10px 0; border-top:1px solid #eee; }
        .wa-float { position:fixed; bottom:80px; left:20px; background:#25D366; color:white; padding:12px; border-radius:50px; text-decoration:none; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="setup-screen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:2000; padding:20px; box-sizing:border-box;">
    <div class="card" style="text-align:center;">
        <h2>Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø¯ÙƒØ§ÙƒÙŠÙ† ğŸª</h2>
        <div id="reg-form">
            <input type="text" id="reg-name" placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¯ÙƒØ§Ù†">
            <input type="text" id="reg-store" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØ§Ù†">
            <input type="text" id="reg-loc" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ù…Ø±Ø¨Ø¹">
            <input type="tel" id="reg-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
            <button class="main-btn" onclick="submitData()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ“¤</button>
        </div>
        <div id="activate-form" style="display:none;">
            <p>âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ. Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ØªÙØ¹ÙŠÙ„:</p>
            <input type="text" id="sec-code" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
            <button class="main-btn" style="background:var(--secondary);" onclick="verify()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ğŸš€</button>
        </div>
    </div>
</div>

<div id="app" class="container">
    <div class="card" style="background:var(--primary); color:white; text-align:center;">
        <h3 id="welcome">ÙŠØ§ Ù…Ø±Ø­Ø¨ Ø¨ÙŠÙƒ</h3>
        Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…: <b id="profit">0</b> Ø¬
    </div>
    
    <div class="card">
        <h4>ğŸ§¾ Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯</h4>
        <select id="p-select" onchange="updatePrice()"></select>
        <input type="number" id="p-qty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        <button class="main-btn" onclick="doSale()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© ğŸ–¨ï¸</button>
    </div>
</div>

<a id="wa-link" href="#" class="wa-float" target="_blank">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>

<script>
    // Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ù‡Ù†Ø§
    const firebaseConfig = { apiKey: "YOUR_API_KEY", databaseURL: "YOUR_DB_URL", projectId: "YOUR_ID" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let db = { p: JSON.parse(localStorage.getItem('p')) || [], s: [] };

    if (!localStorage.getItem('active')) {
        document.getElementById('setup-screen').style.display = 'block';
    } else {
        document.getElementById('welcome').innerText = "ÙŠØ§ Ù…Ø±Ø­Ø¨ ÙŠØ§ " + localStorage.getItem('userName');
        updateLocation();
        setupWhatsApp();
    }

    function submitData() {
        const info = { name: document.getElementById('reg-name').value, store: document.getElementById('reg-store').value, phone: document.getElementById('reg-phone').value };
        database.ref('requests').push(info).then(() => {
            document.getElementById('reg-form').style.display = 'none';
            document.getElementById('activate-form').style.display = 'block';
        });
    }

    function verify() {
        const code = document.getElementById('sec-code').value;
        database.ref('activations/' + code).once('value').then(snap => {
            if(snap.exists()){
                localStorage.setItem('active', 'true');
                localStorage.setItem('userName', snap.val().name);
                localStorage.setItem('storeId', code);
                location.reload();
            } else { alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£"); }
        });
    }

    function updateLocation() {
        navigator.geolocation.getCurrentPosition(pos => {
            database.ref('stores/' + localStorage.getItem('storeId') + '/location').set({
                lat: pos.coords.latitude, lng: pos.coords.longitude
            });
        });
    }

    function setupWhatsApp() {
        const msg = encodeURIComponent("Ø£Ø­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¯ÙƒØ§ÙƒÙŠÙ†");
        document.getElementById('wa-link').href = "https://wa.me/249901946410?text=" + msg;
    }
</script>
</body>
</html>
